// prisma/schema.prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("STAFF") // ADMIN, STAFF, MANAGER, DRIVER, OPERATION_OFFICER
  image     String?  // Base64 or URL
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trips     Trip[]

  @@map("User")
}

model Shipment {
  id             String           @id @default(uuid())
  waybillNumber  String           @unique // e.g., KPL-8829
  
  // Sender Details
  senderName     String
  senderPhone    String
  senderAddress  String?
  
  // Receiver Details
  receiverName   String
  receiverPhone  String
  receiverAddress String?
  
  // Shipment Details
  origin         String
  destination    String
  weight         Float?
  price          Float?
  cargoDetails   String?
  
  currentStatus  String   @default("PENDING")
  receiverSignature String? // Base64 signature
  receivedBy     String?  // Name of the person who actually received it
  
  events         TrackingEvent[]
  trips          Trip[]
  
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@map("Shipment")
}

model Trip {
  id            String    @id @default(uuid())
  driverId      String
  driver        User      @relation(fields: [driverId], references: [id])
  shipmentId    String?
  shipment      Shipment? @relation(fields: [shipmentId], references: [id])
  
  startLocation String
  endLocation   String
  startTime     DateTime  @default(now())
  endTime       DateTime?
  status        String    @default("ACTIVE") // ACTIVE, COMPLETED, CANCELLED

  checkIns      CheckIn[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("Trip")
}

model CheckIn {
  id        String   @id @default(uuid())
  tripId    String
  trip      Trip     @relation(fields: [tripId], references: [id])
  
  location  String   // Text description
  latitude  Float
  longitude Float
  status    String   // OK, BREAKDOWN, RESTING
  
  timestamp DateTime @default(now())

  @@map("CheckIn")
}

model TrackingEvent {
  id          String         @id @default(uuid())
  shipmentId  String
  shipment    Shipment       @relation(fields: [shipmentId], references: [id])
  
  status      String
  location    String         // e.g., "Dar es Salaam Hub"
  remarks     String?        // e.g., "Dispatched to Mwanza Branch"
  
  timestamp   DateTime       @default(now())

  @@map("TrackingEvent")
}
